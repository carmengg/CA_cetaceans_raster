---
title: "cetaceans_raster_map"
author: "Carmen Galaz-Garc√≠a"
date: "2/22/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(raster)
library(tidyverse)
library(here)
library(sf)
library(fasterize)

library(rnaturalearth)
library(sp)
```


```{r}
file_1 <- here('ca_cetaceans/Balaenoptera_acutorostrata.tif')
file_2 <- here('ca_cetaceans/Balaenoptera_borealis.tif')

ls_1 <- raster(file_1)
ls_2 <- raster(file_2)

plot(ls_1)
plot(ls_2)
```

## Preparing the data

```{r}
presence <- function(x, thresh = 0.8) {
  return(ifelse(x >= thresh, 1, NA))
}

w1 <- calc(ls_1, fun=presence)
w2 <- calc(ls_2, fun=presence)


plot(w1)
plot(w2)

plot(w1 + w2)

```

```{r}
# Read in raster files

raster_files <-list.files(path = here('ca_cetaceans'), full.names = TRUE)


#ls1 <- raster(raster_files[1])

all_whales <- raster::stack(raster_files)
presence_layers <- calc(all_whales, fun=presence)

plot(presence_layers)
```


```{r}
diversity <- calc(presence_layers, fun=sum, na.rm=T)
plot(diversity)
```



```{r}
coastline110 <- ne_download(scale = 110, type = 'coastline', category = 'physical', returnclass = "sf")

plot(coastline110)
```

```{r}
diversity <- raster::rasterToPoints(diversity) %>%
  as.data.frame()

ggplot(data = diversity_df, aes(x = x, y = y, fill = layer)) +
  geom_raster() +
  coord_sf(expand = 0) +
  scale_fill_gradient(low = 'white', high = 'blue4')+
  labels(layer = 'Number of cetacean species')


  geom_raster(data = forest_df, fill = 'green') +
  
  theme_void() +
  theme(panel.background = element_rect(fill = 'slateblue4'))
```



